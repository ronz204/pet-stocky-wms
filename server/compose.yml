services:
  elysia:
    build:
      context: .
      target: development
      dockerfile: dockerfile
    extends:
      file: override.yml
      service: elysia
    container_name: elysia-dev
    restart: unless-stopped
    develop:
      watch:
        # Sync source code changes
        - action: sync
          path: ./source
          target: /usr/src/app/source

        # Rebuild when Prisma models change
        - action: rebuild
          path: ./prisma/

        # Sync package.json for dependency tracking
        - action: sync
          path: ./package.json
          target: /usr/src/app/package.json

        # Rebuild when dependencies change
        - action: rebuild
          path: ./bun.lock
  
  migrations:
    build:
      context: .
      target: development
      dockerfile: dockerfile
    extends:
      file: override.yml
      service: migrations
    container_name: migrations-dev
    # Do not restart the migrations container
    restart: "no"
